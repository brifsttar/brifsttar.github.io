---
published: false
title: nDisplay
---
[nDisplay](https://docs.unrealengine.com/en-US/WorkingWithMedia/nDisplay/index.html) is Unreal Engine's tool for [CAVE](https://en.wikipedia.org/wiki/Cave_automatic_virtual_environment) and other cluster rendering, allowing simulation to be displayed on any amount of screens from any amount of computers. However, getting nDisplay to work for *driving* simulation can be challenging.

[![CAVE](/images/360sim.jpg)][2]

First, I recommand reading the [Synchronization in nDisplay] article, which didn't exist when I started using the tool, and would have been of great help if it did.

# Non-deterministic physics

One of the first hurdle I encountered with nDisplay was when I noticed that as time went by during the simulation, cars' position's would start to diverge from one screen to the next. In the first seconds, it would be near invisible, but after a few minutes, some cars could be at totally different places on each monitor.

This is caused by [PhysX](https://docs.nvidia.com/gameworks/content/gameworkslibrary/physx/guide/Manual/Vehicles.html)'s non-deterministic model. Behind the scenes, nDisplay synchronizes all instances' clocks, and each instance then "solves" the simulation for that given time. But if the physics model is non-deterministic, you can then have two instances having very slight differences in their outputs, placing cars at very slightly different positions. Over the course of a whole scenario, this can lead to drastic differences.

As I'm writing this (4.26), [Chaos](https://docs.unrealengine.com/en-US/InteractiveExperiences/Physics/ChaosPhysics/Overview/index.html) is still experimental and not part of the official release. But this new physics engine might solve this issue by itself, as it seems Epic Games added a deterministic mode for nDisplay use cases.

![ndisp_physx.png]({{site.baseurl}}/images/ndisp_physx.png)

Our workaround, as shown above, is to disable all car's physics on all cluster slaves, having only the master solving their position. Cars' transform is then sync'd with slaves using [Actor Replication](https://docs.unrealengine.com/en-US/WorkingWithMedia/nDisplay/Replication/index.html).

# Swap sync policy

Before the [Synchronization in nDisplay] page existed, I spent way too much time discovering the `swap_sync_policy` existed. My issue was that for some reason, when using nDisplay, the simulation wouldn't run past 30Hz, even though it could run at 120Hz on a single instance without issue. But as soon as I connected any slave, it would cap at 30Hz.

It turned out that our simulator's TVs are 50Hz, and `swap_sync_policy` defaults to `1`, which now that we have this new document we can have a better understanding of:

> This means VSync=1. All nodes show their frames after RenderThreadBarrier WITH synchronization to VBlank.

So if you have 50Hz TVs, you probably want a `swap_sync_policy` of `0`. Which now means that you have tearing all over your screen. Which is the current situation I'm at.

# Fake ego-chassis

If you disabled swap sync and you're in a setup where you display ego's chassis on screen for better immersion (e.g. not full scale simulator), you'll end up having a lot of stutter on said chassis.

I'm still not sure why it happens, but I'm guessing it's because without swap sync, each slave renders when it wants, and at the time each one does that, some have received the lastest ego position and some have not (from the actor replication mentioned above). This is a very common problem when rendering on a cluster without synchronization.

![ndisp_chassis.png]({{site.baseurl}}/images/ndisp_chassis.png)

To solve this issue, and as illustrated above, we simply hide ego's chassis, and on each slave we create a new "fake" one that we attach to nDisplay's root actor. With such attachment, this fake chassis will always have the same position relative to nDisplay's root, and therefore relative to each screen. No more stuttering!

# Mirrors

# Cluster events

# Stutter

[2]: https://www.cnet.com/roadshow/news/general-motors-gm-360-degree-simulator/

[Synchronization in nDisplay]: https://docs.unrealengine.com/en-US/WorkingWithMedia/nDisplay/Synchronization/index.html